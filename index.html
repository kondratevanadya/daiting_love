<!DOCTYPE html>
<html>
<head>
  <title>Mini App</title>
</head>
<body>
  <h1>Ваш профиль</h1>
  <div id="profile"></div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const tgUser = window.Telegram.WebApp.initDataUnsafe.user;
    const profileDiv = document.getElementById('profile');

    // Сохраняем данные в бэк сразу при открытии мини-апа
    async function saveProfile() {
      const payload = {
        tg_id: tgUser.id,
        nickname: tgUser.username || tgUser.first_name,
        age: null,               // пока пользователь не ввёл возраст
        avatar_url: tgUser.photo_url || null
      };

      await fetch('datinglove-backend-production.up.railway.app/saveProfile', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(payload)
      });

      showProfile(payload);
    }

    // Отображаем профиль
    function showProfile(user) {
      profileDiv.innerHTML = `
        <p>Ник: ${user.nickname}</p>
        <p>Возраст: ${user.age ? user.age : 'не указан'}</p>
        ${user.avatar_url ? `<img src="${user.avatar_url}" width="100"/>` : ''}
      `;
    }

    // Сохраняем и отображаем сразу
    saveProfile();
  </script>
</body>
</html>
